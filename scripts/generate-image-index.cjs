const fs = require('fs');
const path = require('path');

const imagesDir = path.join(__dirname, '..', 'public', 'images', 'recipes');
const outputFile = path.join(__dirname, '..', 'src', 'generated', 'recipeImageIndex.ts');

// Ensure output directory exists
const outputDir = path.dirname(outputFile);
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

// Read all files in the images directory
const files = fs.readdirSync(imagesDir);

// Create a map of recipe slug to image filename
const imageMap = {};

files.forEach(file => {
  const ext = path.extname(file);
  const slug = path.basename(file, ext);

  // Skip non-image files and the default image
  if (!['.jpg', '.jpeg', '.png', '.webp', '.svg'].includes(ext.toLowerCase())) {
    return;
  }

  if (slug === 'default-recipe') {
    return;
  }

  // Store the full filename (with extension)
  imageMap[slug] = file;
});

// Generate TypeScript file
const tsContent = `// This file is auto-generated by scripts/generate-image-index.cjs
// Do not edit manually

export const RECIPE_IMAGE_INDEX: Record<string, string> = ${JSON.stringify(imageMap, null, 2)};
`;

fs.writeFileSync(outputFile, tsContent, 'utf8');

console.log(`âœ“ Generated image index with ${Object.keys(imageMap).length} entries`);
console.log(`  Output: ${path.relative(process.cwd(), outputFile)}`);
